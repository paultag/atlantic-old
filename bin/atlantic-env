#!/usr/bin/env python

import sys
import json
import os.path

obj = json.load(open(os.path.expanduser("~/.atlanticrc"), 'r'))

master = obj['master']

env_mapping = {
    "ATLANTIC_MASTER": master['host'],
    "ATLANTIC_LOGIN": master['login'],
    "ATLANTIC_KEY": master['key'],
    "MONOMOY_BINARY": master['monomoy'],
    "MONOMOY_CONF": master['conf'],
    "MONOMOY_BUILDER_NAME": obj['name']
}


if len(sys.argv) > 1:
    bld = json.load(open(sys.argv[1], 'r'))
    dist, compiler, arch = None, None, None
    for requirement in bld['requirements']:
        if requirement in obj['arches']:
            arch = requirement

        if requirement in obj['compilers']:
            compiler = requirement

        if requirement in obj['suites']:
            dist = requirement

    env_mapping.update({
        "ATLANTIC_COMPILER": compiler,
        "ATLANTIC_SUITE": dist,
        "ATLANTIC_ARCH": arch
    })


for env in env_mapping:
    print "export %s=%s" % (
        env, env_mapping[env]
    )
