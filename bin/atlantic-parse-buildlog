#!/usr/bin/env python

import json
import sys
import os

if not "ATLANTIC_BUILD_ID" in os.environ:
    print "Atlantiv env sucks."
    sys.exit(1)

resp = {
    "warning": [],
    "error": [],
    "info": [],
    "pedantic": [],
    "other": [],
    "exp": []
}

flags = {
    "w: ": "warning",
    "e: ": "error",
    "i: ": "info",
    "p: ": "pedantic",
    "x: ": "exp"
}

lookfor = {
    "warning": "warning",
    "error": "error"
}

flag = 3

lines = open(sys.argv[1], 'r').readlines()

for line in lines:
    f = line[:flag].lower()
    if f in flags:
        resp[flags[f]].append(line.strip())

    for l in lookfor:
        if l in line.lower():
            resp[lookfor[l]].append(line.strip())

job = os.environ['ATLANTIC_BUILD_ID']
resp['build'] = job

print json.dumps(resp)
